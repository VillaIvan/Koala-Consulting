---
import Met2 from "@/components/Met2.astro";
import TabNavigation from "@/components/TabNavigation.astro";
import Timeline from "@/components/Timeline.astro";
import Counter from "@/components/Counter.astro";
import AUSection from "@/components/AUSection.astro";
import FeatureDiagram from "@/components/FeatureDiagram.astro";
---

<section id="panels">
  <div id="panels-container" style="width: 400%;">
    <article id="panel-1" class="panel full-screen">
      <div class="container">
        <section class="mx-auto max-w-7xl mb-20 p-4" id="nosotros">
          <div class="p-2">
            <h3
              class="text-5xl md:text-6xl text-white font-semibold text-center mb-5"
            >
              ¿Quiénes Somos?
            </h3>
          </div>
          <hr class="w-52 mx-auto border-t border-gray-300 mb-5" />
          <div class="p-2">
            <p
              class="text-lg md:text-2xl lg:text-xl text-white font-normal mb-20 lg:mb-10 text-start md:text-center w-[76%] md:w-full mx-auto"
            >
              Somos una empresa líder en consultoría estratégica con una
              trayectoria de más de 10 años en optimización de procesos en las
              industrias aseguradoras y tecnológicas. Nos especializamos en
              identificar oportunidades de mejora y en implementar soluciones
              que tienen un impacto directo en la eficiencia, el costo
              operativo, las ventas y la satisfacción del cliente. Nuestro
              objetivo es impulsar el éxito de su negocio a través de
              estrategias innovadoras y personalizadas.
            </p>
          </div>
          <AUSection />
          <!-- <Counter /> -->
          <!-- <Timeline /> -->
        </section>
      </div>
    </article>
    <article id="panel-2" class="panel full-screen">
      <div class="container">
        <section
          class="h-auto md:h-[100vh] max-w-7xl m-auto p-4 flex flex-col justify-center"
          id="servicios"
        >
          <div class="p-2">
            <h3
              class="text-5xl md:text-6xl text-white font-semibold text-center mb-5"
            >
              ¿Que hacemos?
            </h3>
          </div>
          <hr class="w-52 mx-auto border-t border-gray-300 mb-5" />
          <TabNavigation />
          <!-- <FeatureDiagram /> -->
        </section>
      </div>
    </article>
    <article id="panel-2" class="panel full-screen">
      <div class="container">
        <section
          class="h-auto md:h-[100vh] max-w-7xl m-auto p-4 flex flex-col justify-center"
          id="servicios"
        >
          <div class="p-2">
            <h3
              class="text-5xl md:text-6xl text-white font-semibold text-center mb-5"
            >
              ¿Que hacemos?
            </h3>
          </div>
          <hr class="w-52 mx-auto border-t border-gray-300 mb-5" />
          <!-- <TabNavigation /> -->
          <FeatureDiagram />
        </section>
      </div>
    </article>
    <article id="panel-3" class="panel full-screen gradient-green">
      <div class="container">
        <section class="mx-auto max-w-7xl mb-20 p-4" id="nosotros">
          <div class="p-2">
            <h3
              class="text-5xl md:text-6xl text-white font-semibold text-center mb-5"
            >
              ¿Como lo hacemos?
            </h3>
          </div>
          <hr class="w-52 mx-auto border-t border-gray-300 mb-10" />
          <div class="flex justify-center items-center">
            <Met2 />
          </div>
        </section>
      </div>
    </article>
  </div>
</section>

<style>
  h1,
  h2 {
    text-align: center;
  }

  .full-screen {
    display: block;
    width: 100%;
    height: 100vh;
    overflow: hidden;
  }

  #masthead {
    position: fixed;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    z-index: 9999;
  }
  #masthead a {
    padding: 1rem 2rem;
  }

  #panels #panels-container {
    height: 100vh;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -ms-flex-wrap: nowrap;
    flex-wrap: nowrap;
    padding: 0;
    overflow: hidden;
  }
  #panels #panels-container .panel {
    position: relative;
    width: 100%;
    height: 100vh;
    overflow: hidden;
    display: flex;
    text-align: left;
    align-items: center;
    justify-content: center;
  }
  #panels #panels-container .panel img {
    max-width: 100%;
    height: auto;
    display: block;
  }
  #panels #panels-container .panel .panels-navigation {
    width: 100%;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-pack: end;
    -ms-flex-pack: end;
    justify-content: flex-end;
  }
  #panels #panels-container .panel .anchor-panel,
  #panels #panels-container .panel .nav-panel {
    text-transform: uppercase;
    margin-right: 2rem;
  }
  #panels #panels-container .panels-navigation {
    position: absolute;
    width: 100%;
    bottom: 2rem;
    right: 2rem;
  }

  @media (max-width: 768px) {
    #panels-container {
      display: flex;
      flex-direction: column; /* Hace que los contenedores se apilen uno debajo del otro */
      width: 100% !important;
      height: auto !important; /* Permite que los contenedores tengan una altura automática */
      overflow-x: visible !important; /* Asegura que no haya desbordamiento horizontal */
    }

    .panel {
      width: 100% !important; /* Asegura que cada panel ocupe el 100% del ancho */
      height: auto !important; /* Ajusta la altura de cada panel según el contenido */
      margin-bottom: 20px; /* Agrega espacio entre los paneles */
    }

    /* Ajusta el texto o el contenido que pueda estar causando problemas */
    .panel-content {
      font-size: 16px !important; /* Ajusta el tamaño de texto si es necesario */
    }
  }
</style>

<script>
  import { gsap } from "gsap";
  import ScrollTrigger from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  // Inicializa la animación GSAP
  function initGsap() {
    console.log("Iniciando GSAP..."); // Depuración para verificar si se llama
    const panelsContainer = document.querySelector(
      "#panels-container"
    ) as HTMLElement;
    const panels = gsap.utils.toArray("#panels-container .panel");

    // Verificar si los elementos necesarios existen
    if (!panelsContainer || panels.length === 0) {
      console.warn("No se encontraron elementos para inicializar GSAP.");
      return;
    }

    gsap.to(panels, {
      xPercent: -100 * (panels.length - 1),
      ease: "none",
      scrollTrigger: {
        trigger: "#panels-container",
        pin: true,
        start: "top top",
        scrub: 1,
        snap: {
          snapTo: 1 / (panels.length - 1),
          inertia: false,
          duration: { min: 0.1, max: 0.1 },
        },
        end: () => "+=" + (panelsContainer.offsetWidth - window.innerWidth),
      },
    });
  }

  const paragraph = document.querySelector(".para");

  // Configuración de la animación de opacidad del párrafo
  gsap.fromTo(
    paragraph,
    { opacity: 0 },
    {
      opacity: 1,
      duration: 4,
      scrollTrigger: {
        trigger: paragraph,
        start: "top 90%", // La animación comienza cuando el top llega al 90% del viewport
        end: "+=300", // La animación finaliza cuando el desplazamiento es de 300px
        scrub: 3, // La animación se ajusta al desplazamiento de la página
        markers: true,
      },
    }
  );

  function setupGsapForMobile() {
    const isMobile = window.matchMedia("(max-width: 768px)").matches;

    // Limpia animaciones existentes
    ScrollTrigger.getAll().forEach((trigger) => trigger.kill());

    if (isMobile) {
      // Desactivar animación de scroll horizontal en móvil
      console.log("Dispositivo móvil detectado. Desactivando GSAP...");
      gsap.to("#panels-container", { xPercent: 0 }); // Resetea el desplazamiento horizontal
      // Aquí puedes añadir cualquier lógica para cambiar la estructura en móviles si lo necesitas
    } else {
      initGsap();
      console.log("Modo desktop. ScrollTrigger activado.");
    }
  }

  // Ejecutar al cargar la página
  window.addEventListener("load", () => {
    console.log("Página cargada. Configurando GSAP...");
    setupGsapForMobile();
  });

  // Re-evaluar al cambiar el tamaño de la ventana
  window.addEventListener("resize", setupGsapForMobile);
</script>
